# Folder Layout Proposal — Hybrid v3 Plan

This layout encodes the factory pattern: fake team proxies, factory components, and generated Santiagos with provenance, capability levels, and storage tier mapping.

---

## Proposed Directory Tree

```text
knowledge/
├── catches/index.yaml         # Trust registry (versions, hashes, capability levels, replacement decisions)
├── catches/                    # Generated Santiagos (factory outputs) — hot tier (internal 4TB NVMe)
│   └── santiago-pm-safe-xp/
│       ├── domain-knowledge/   # Markdown + YAML extracted from sources
│       ├── bdd-tests/          # Feature files from Fishnet linked to knowledge nodes
│       ├── mcp-manifest.json   # Auto-generated with capability level + knowledge scope
│       └── provenance.yaml     # Fishing expedition metadata (sources, cycles, timestamps)
├── templates/                  # Base structures for generating Santiagos
├── proxy-instructions/         # Role definitions for fake team
│   ├── pm-role.md
│   ├── architect-role.md
│   ├── developer-role.md
│   ├── qa-role.md
│   ├── ux-role.md
│   ├── platform-role.md
│   └── ethicist-role.md
└── shared/                     # Shared memory (team roster TTL, working agreements)

santiago_core/
├── agents/
│   ├── _proxy/                 # Phase 0: Fake team (MCP proxies)
│   │   ├── pm_proxy.py
│   │   ├── architect_proxy.py
│   │   ├── developer_proxy.py
│   │   ├── qa_proxy.py
│   │   ├── ux_proxy.py
│   │   ├── platform_proxy.py
│   │   └── ethicist_proxy.py
│   └── santiago-pm-safe-xp/    # Phase 2+: Real Santiagos (factory-generated)
│       └── service/            # MCP service implementation
└── ...

nusy_orchestrator/
└── santiago_builder/           # Factory components
    ├── navigator.py            # Orchestrates fishing expeditions (10-step process)
    ├── catchfish.py            # Knowledge extraction (30–60m → <15m target)
    ├── fishnet.py              # BDD test generation + manifest inference
    └── pipelines/
        └── provenance_queue.py # Queued write pipeline with schema validation
```

---

## Storage Tier Mapping

- **Hot Tier (Internal 4TB NVMe)**: `knowledge/catches/` for active working catches, `santiago_core/agents/` for deployed services, current model weights
- **Warm Tier (External 8-16TB RAID)**: Historical catches (`knowledge/archive/catches-YYYY-MM/`), older model checkpoints, experiment artifacts
- **Cold Tier (NAS)**: Long-term provenance ledgers, ships-logs archives, audit trails older than 90 days

Lifecycle policies:

- Active catches migrate from hot → warm after 30 days of inactivity
- Warm tier catches migrate to cold after 180 days
- All tiers maintain full provenance for replay capability

---

## Mapping Table (Current → Target → Action)

- Current: `ocean-research/fake_team_pack/` → Target: `santiago_core/agents/_proxy/` → Action: Implement proxies using patterns from pack
- Current: `santiago-pm/strategic-charts/Old man and the sea.md` → Target: `nusy_orchestrator/santiago_builder/navigator.py` → Action: Encode 10-step process and validation loops
- Current: `nusy_prototype/` → Target: `nusy_orchestrator/santiago_builder/catchfish.py` → Action: Extract 4-layer pipeline concepts; implement generalized extractor
- Current: `santiago-pm/voyage-trials/` → Target: `knowledge/catches/*/bdd-tests/` → Action: Generate BDD via Fishnet; align with existing style
- Current: `santiago_core/` (service scaffolds) → Target: `santiago_core/agents/santiago-*/service/` → Action: House real MCP services generated by factory
- Current: (missing) → Target: `knowledge/` (all subdirs) → Action: Create new structure; enforce schema + provenance
- Current: (missing) → Target: `nusy_orchestrator/santiago_builder/` → Action: Add Navigator, Catchfish, Fishnet modules
- Current: (missing) → Target: `nusy_orchestrator/santiago_builder/pipelines/provenance_queue.py` → Action: Implement queued write pipeline with idempotency
- Current: `src/nusy_pm_core/` (legacy) → Target: (reference only) → Action: Deprecate; do not refactor into factory
- Current: `santiago-code/` (archived) → Target: (reference only) → Action: Preserve for context; avoid duplication

---

## Notes

- `knowledge/catches/index.yaml` serves as trust registry; includes entries for each caught Santiago with version, hash, capability level (Apprentice/Journeyman/Master), knowledge scope (Pond/Lake/Sea/Ocean), and validation status
- MCP manifests are generated by Fishnet with capability metadata and co-located under each catch folder; services consume them on deploy
- Orchestrator routes requests to proxies or real Santiagos based on replacement status, budgets, and capability requirements
- Hybrid routing (80/20 splits) supported via traffic_split field in trust registry entries
- Storage tiers enable cost-effective scaling while maintaining hot-path performance
